<%- include('blocks/header', {bot, user, path}) %>
<!-- <h1 class="display-3 mx-auto">Dashboard</h1> -->
<ul class="list-unstyled">
  <% user.guilds.forEach(guild => {
    const permsOnGuild = new perms(guild.permissions);
    if(!permsOnGuild.has("MANAGE_GUILD")) return;
  %>

  <div class="h-75 row align-items-center ">
    <div class="media-body">
      <div class="container w-50">
        <div class="row justify-content-md-center">

          <div class="col-md-auto">
            <li class="media" style="padding: 10px;">
              <% if (guild.icon) { %>
                <img class="d-flex mr-3 rounded-circle" src="<%= `https://cdn.discordapp.com/icons/${guild.id}/${guild.icon}.png?size=128` %>" style="width: 80px;" alt="">
                <% } else { %>
                  <canvas style="background-color: #7289da" class="d-flex mr-3 rounded-circle" id="<%= guild.name.split(' ').join('').replace(`'`, ``) %>" width="80px" height="80px"></canvas>
                  <script>
                    function draw() {
                      const ctx = document.getElementById("<%= guild.name.split(' ').join('').replace(`'`, ``) %>").getContext('2d');
                      ctx.font = '20px Arial';
                      ctx.textAlign = "center";
                      ctx.fillStyle = "white";
                      ctx.fillText("<%= guild.name.split(' ').map(v => v[0]).join('') %>", 40, 50);
                    };
                    draw();
                  </script>
                  <% } %>
                </li>
              </div>

              <div class="col-sm align-items-center">
                <h5 class="mt-0 mb-1 align-middle"><%= guild.name %></h5>
              </div>

              <div class="col-sm text-right">

                <%
                let href, text;
                let enabled;
                if(bot.guilds.cache.get(guild.id)) {
                  href = `/dashboard/${guild.id}/manage`;
                  text = "Go to Dashboard";
                  enabled = true;
                  btnClass = "btn btn-success"
                } else {
                  href = `https://discordapp.com/oauth2/authorize?client_id=${bot.application.id}&scope=bot&permissions=1007021143&guild_id=${guild.id}&response_type=code&redirect_uri=${encodeURIComponent(bot.config.dashboard.callbackURL)}`;
                  text = "Set Up Pal";
                  enabled = bot.application.botPublic;
                  btnClass = "btn btn-secondary"
                }
                %>
                <a class="btn <%= btnClass %><% if(!enabled) { %> disabled<% } %>" role="button" href="<%= href %>"><%= text %> <!--<i class="fa fa-fw fa-chevron-circle-right" aria-hidden="true"></i>--></a>
              </div>

              <!-- <div class="col-">
              </div> -->
            </div>
          </div>
        </div>
      </div>
    <% }); %>
  </ul>
    <%- include('./blocks/footer') %>
